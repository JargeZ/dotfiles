#!/bin/bash

# Script to switch displays

if [[ "$#" = 0 ]]; then
    echo Please choose a display
    exit
fi

HIGH_DPI=336
LOW_DPI=96

FIREFOX_RUNNING=$(pgrep -c firefox)

if [ "$FIREFOX_RUNNING" != "0" ]; then
    echo "Close firefox before switching displays"
fi

if [ "$1" = high ]; then
    DPI=$HIGH_DPI
    setxkbmap -option caps:swapescape
    xrandr --dpi $DPI --output "eDP-1" --auto --output "DP-2" --off
elif [ "$1" = low ]; then
    DPI=$LOW_DPI
    setxkbmap -option 
    xrandr --dpi $DPI --output "eDP-1" --off --output "DP-2" --auto
else
    echo "$1" is not a valid display
    exit
fi

TERMINAL_CONFIG=$HOME/.config/alacritty.yml
FIREFOX_CONFIG=$HOME/.mozilla/firefox/f4jbau39.default-release/user.js
DISPLAY_FOLDER=$HOME/.local/displays/"$1"

ln -sf "$DISPLAY_FOLDER"/alacritty.yml "$TERMINAL_CONFIG"
if [ "$FIREFOX_RUNNING" == "0" ]; then
    ln -sf "$DISPLAY_FOLDER"/firefox.js "$FIREFOX_CONFIG"
else
    echo "Firefox changes not being applied"
fi

if [[ "$(pgrep xmonad)" ]]; then
    CURRENT_DISPLAY="$1" xmonad --restart
fi

feh --no-fehbg --bg-fill "$HOME/Pictures/bg.png"
